!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";function n(t,e,i,n){for(var r=t[e++],s=1<<r,a=s+1,o=a+1,u=r+1,h=(1<<u)-1,l=0,m=0,c=0,_=t[e++],d=new Int32Array(4096),p=null;;){for(;l<16&&0!==_;)m|=t[e++]<<l,l+=8,1===_?_=t[e++]:--_;if(l<u)break;var f=m&h;if(m>>=u,l-=u,f!==s){if(f===a)break;for(var g=f<o?f:p,M=0,b=g;b>s;)b=d[b]>>8,++M;var w=b;if(c+M+(g!==f?1:0)>n)return void console.log("Warning, gif stream longer than expected.");i[c++]=w;var y=c+=M;for(g!==f&&(i[c++]=w),b=g;M--;)b=d[b],i[--y]=255&b,b>>=8;null!==p&&o<4096&&(d[o++]=p<<8|w,o>=h+1&&u<12&&(++u,h=h<<1|1)),p=f}else o=a+1,h=(1<<(u=r+1))-1,p=null}return c!==n&&console.log("Warning, gif stream shorter than expected."),i}try{e.GifWriter=function(t,e,i,n){var r=0,s=void 0===(n=void 0===n?{}:n).loop?null:n.loop,a=void 0===n.palette?null:n.palette;if(e<=0||i<=0||e>65535||i>65535)throw new Error("Width/Height invalid.");function o(t){var e=t.length;if(e<2||e>256||e&e-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return e}t[r++]=71,t[r++]=73,t[r++]=70,t[r++]=56,t[r++]=57,t[r++]=97;var u=0,h=0;if(null!==a){for(var l=o(a);l>>=1;)++u;if(l=1<<u,--u,void 0!==n.background){if((h=n.background)>=l)throw new Error("Background index out of range.");if(0===h)throw new Error("Background index explicitly passed as 0.")}}if(t[r++]=255&e,t[r++]=e>>8&255,t[r++]=255&i,t[r++]=i>>8&255,t[r++]=(null!==a?128:0)|u,t[r++]=h,t[r++]=0,null!==a)for(var m=0,c=a.length;m<c;++m){var _=a[m];t[r++]=_>>16&255,t[r++]=_>>8&255,t[r++]=255&_}if(null!==s){if(s<0||s>65535)throw new Error("Loop count invalid.");t[r++]=33,t[r++]=255,t[r++]=11,t[r++]=78,t[r++]=69,t[r++]=84,t[r++]=83,t[r++]=67,t[r++]=65,t[r++]=80,t[r++]=69,t[r++]=50,t[r++]=46,t[r++]=48,t[r++]=3,t[r++]=1,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=0}var d=!1;this.addFrame=function(e,i,n,s,u,h){if(!0===d&&(--r,d=!1),h=void 0===h?{}:h,e<0||i<0||e>65535||i>65535)throw new Error("x/y invalid.");if(n<=0||s<=0||n>65535||s>65535)throw new Error("Width/Height invalid.");if(u.length<n*s)throw new Error("Not enough pixels for the frame size.");var l=!0,m=h.palette;if(null==m&&(l=!1,m=a),null==m)throw new Error("Must supply either a local or global palette.");for(var c=o(m),_=0;c>>=1;)++_;c=1<<_;var p=void 0===h.delay?0:h.delay,f=void 0===h.disposal?0:h.disposal;if(f<0||f>3)throw new Error("Disposal out of range.");var g=!1,M=0;if(void 0!==h.transparent&&null!==h.transparent&&(g=!0,(M=h.transparent)<0||M>=c))throw new Error("Transparent color index.");if((0!==f||g||0!==p)&&(t[r++]=33,t[r++]=249,t[r++]=4,t[r++]=f<<2|(!0===g?1:0),t[r++]=255&p,t[r++]=p>>8&255,t[r++]=M,t[r++]=0),t[r++]=44,t[r++]=255&e,t[r++]=e>>8&255,t[r++]=255&i,t[r++]=i>>8&255,t[r++]=255&n,t[r++]=n>>8&255,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=!0===l?128|_-1:0,!0===l)for(var b=0,w=m.length;b<w;++b){var y=m[b];t[r++]=y>>16&255,t[r++]=y>>8&255,t[r++]=255&y}return r=function(t,e,i,n){t[e++]=i;var r=e++,s=1<<i,a=s-1,o=s+1,u=o+1,h=i+1,l=0,m=0;function c(i){for(;l>=i;)t[e++]=255&m,m>>=8,l-=8,e===r+256&&(t[r]=255,r=e++)}function _(t){m|=t<<l,l+=h,c(8)}var d=n[0]&a,p={};_(s);for(var f=1,g=n.length;f<g;++f){var M=n[f]&a,b=d<<8|M,w=p[b];if(void 0===w){for(m|=d<<l,l+=h;l>=8;)t[e++]=255&m,m>>=8,l-=8,e===r+256&&(t[r]=255,r=e++);4096===u?(_(s),u=o+1,h=i+1,p={}):(u>=1<<h&&++h,p[b]=u++),d=M}else d=w}_(d),_(o),c(1),r+1===e?t[r]=0:(t[r]=e-r-1,t[e++]=0);return e}(t,r,_<2?2:_,u)},this.end=function(){return!1===d&&(t[r++]=59,d=!0),r},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(e){t=e},this.getOutputBufferPosition=function(){return r},this.setOutputBufferPosition=function(t){r=t}},e.GifReader=function(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var i=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,s=t[e++],a=s>>7,o=1<<(7&s)+1;t[e++],t[e++];var u=null,h=null;a&&(u=e,h=o,e+=3*o);var l=!0,m=[],c=0,_=null,d=0,p=null;for(this.width=i,this.height=r;l&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,p=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var f=t[e++];c=t[e++]|t[e++]<<8,_=t[e++],0==(1&f)&&(_=null),d=f>>2&7,e++;break;case 254:for(;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var g=t[e++]|t[e++]<<8,M=t[e++]|t[e++]<<8,b=t[e++]|t[e++]<<8,w=t[e++]|t[e++]<<8,y=t[e++],x=y>>6&1,S=1<<(7&y)+1,v=u,I=h,k=!1;if(y>>7){k=!0;v=e,I=S,e+=3*S}var z=e;for(e++;;){var A;if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}m.push({x:g,y:M,width:b,height:w,has_local_palette:k,palette_offset:v,palette_size:I,data_offset:z,data_length:e-z,transparent_index:_,interlaced:!!x,delay:c,disposal:d});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return m.length},this.loopCount=function(){return p},this.frameInfo=function(t){if(t<0||t>=m.length)throw new Error("Frame index out of range.");return m[t]},this.decodeAndBlitFrameBGRA=function(e,r){var s=this.frameInfo(e),a=s.width*s.height,o=new Uint8Array(a);n(t,s.data_offset,o,a);var u=s.palette_offset,h=s.transparent_index;null===h&&(h=256);var l=s.width,m=i-l,c=l,_=4*(s.y*i+s.x),d=4*((s.y+s.height)*i+s.x),p=_,f=4*m;!0===s.interlaced&&(f+=4*i*7);for(var g=8,M=0,b=o.length;M<b;++M){var w=o[M];if(0===c&&(c=l,(p+=f)>=d&&(f=4*m+4*i*(g-1),p=_+(l+m)*(g<<1),g>>=1)),w===h)p+=4;else{var y=t[u+3*w],x=t[u+3*w+1],S=t[u+3*w+2];r[p++]=S,r[p++]=x,r[p++]=y,r[p++]=255}--c}},this.decodeAndBlitFrameRGBA=function(e,r){var s=this.frameInfo(e),a=s.width*s.height,o=new Uint8Array(a);n(t,s.data_offset,o,a);var u=s.palette_offset,h=s.transparent_index;null===h&&(h=256);var l=s.width,m=i-l,c=l,_=4*(s.y*i+s.x),d=4*((s.y+s.height)*i+s.x),p=_,f=4*m;!0===s.interlaced&&(f+=4*i*7);for(var g=8,M=0,b=o.length;M<b;++M){var w=o[M];if(0===c&&(c=l,(p+=f)>=d&&(f=4*m+4*i*(g-1),p=_+(l+m)*(g<<1),g>>=1)),w===h)p+=4;else{var y=t[u+3*w],x=t[u+3*w+1],S=t[u+3*w+2];r[p++]=y,r[p++]=x,r[p++]=S,r[p++]=255}--c}}}}catch(t){}},function(t,e,i){t.exports=function(){return i(3)('!function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=24)}([function(t,i){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,i,e){e(9),t.exports=e(2).setImmediate},function(t,i){var e=t.exports={version:"2.5.2"};"number"==typeof __e&&(__e=e)},function(t,i){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,i,e){t.exports=!e(6)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,i,e){var n=e(11),s=e(15);t.exports=e(4)?function(t,i,e){return n.f(t,i,s(1,e))}:function(t,i,e){return t[i]=e,t}},function(t,i){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,i,e){var n=e(3),s=e(0).document,r=n(s)&&n(s.createElement);t.exports=function(t){return r?s.createElement(t):{}}},function(t,i,e){var n=e(19);t.exports=function(t,i,e){if(n(t),void 0===i)return t;switch(e){case 1:return function(e){return t.call(i,e)};case 2:return function(e,n){return t.call(i,e,n)};case 3:return function(e,n,s){return t.call(i,e,n,s)}}return function(){return t.apply(i,arguments)}}},function(t,i,e){var n=e(10),s=e(20);n(n.G+n.B,{setImmediate:s.set,clearImmediate:s.clear})},function(t,i,e){var n=e(0),s=e(2),r=e(5),a=e(16),u=e(8),o=function(t,i,e){var h,m,l,_,c=t&o.F,d=t&o.G,p=t&o.S,f=t&o.P,M=t&o.B,g=d?n:p?n[i]||(n[i]={}):(n[i]||{}).prototype,b=d?s:s[i]||(s[i]={}),x=b.prototype||(b.prototype={});for(h in d&&(e=i),e)l=((m=!c&&g&&void 0!==g[h])?g:e)[h],_=M&&m?u(l,n):f&&"function"==typeof l?u(Function.call,l):l,g&&a(g,h,l,t&o.U),b[h]!=l&&r(b,h,_),f&&x[h]!=l&&(x[h]=l)};n.core=s,o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,o.U=64,o.R=128,t.exports=o},function(t,i,e){var n=e(12),s=e(13),r=e(14),a=Object.defineProperty;i.f=e(4)?Object.defineProperty:function(t,i,e){if(n(t),i=r(i,!0),n(e),s)try{return a(t,i,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[i]=e.value),t}},function(t,i,e){var n=e(3);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,i,e){t.exports=!e(4)&&!e(6)((function(){return 7!=Object.defineProperty(e(7)("div"),"a",{get:function(){return 7}}).a}))},function(t,i,e){var n=e(3);t.exports=function(t,i){if(!n(t))return t;var e,s;if(i&&"function"==typeof(e=t.toString)&&!n(s=e.call(t)))return s;if("function"==typeof(e=t.valueOf)&&!n(s=e.call(t)))return s;if(!i&&"function"==typeof(e=t.toString)&&!n(s=e.call(t)))return s;throw TypeError("Can\'t convert object to primitive value")}},function(t,i){t.exports=function(t,i){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:i}}},function(t,i,e){var n=e(0),s=e(5),r=e(17),a=e(18)("src"),u=Function.toString,o=(""+u).split("toString");e(2).inspectSource=function(t){return u.call(t)},(t.exports=function(t,i,e,u){var h="function"==typeof e;h&&(r(e,"name")||s(e,"name",i)),t[i]!==e&&(h&&(r(e,a)||s(e,a,t[i]?""+t[i]:o.join(String(i)))),t===n?t[i]=e:u?t[i]?t[i]=e:s(t,i,e):(delete t[i],s(t,i,e)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||u.call(this)}))},function(t,i){var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},function(t,i){var e=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+n).toString(36))}},function(t,i){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,i,e){var n,s,r,a=e(8),u=e(21),o=e(22),h=e(7),m=e(0),l=m.process,_=m.setImmediate,c=m.clearImmediate,d=m.MessageChannel,p=m.Dispatch,f=0,M={},g=function(){var t=+this;if(M.hasOwnProperty(t)){var i=M[t];delete M[t],i()}},b=function(t){g.call(t.data)};_&&c||(_=function(t){for(var i=[],e=1;arguments.length>e;)i.push(arguments[e++]);return M[++f]=function(){u("function"==typeof t?t:Function(t),i)},n(f),f},c=function(t){delete M[t]},"process"==e(23)(l)?n=function(t){l.nextTick(a(g,t,1))}:p&&p.now?n=function(t){p.now(a(g,t,1))}:d?(r=(s=new d).port2,s.port1.onmessage=b,n=a(r.postMessage,r,1)):m.addEventListener&&"function"==typeof postMessage&&!m.importScripts?(n=function(t){m.postMessage(t+"","*")},m.addEventListener("message",b,!1)):n="onreadystatechange"in h("script")?function(t){o.appendChild(h("script")).onreadystatechange=function(){o.removeChild(this),g.call(t)}}:function(t){setTimeout(a(g,t,1),0)}),t.exports={set:_,clear:c}},function(t,i){t.exports=function(t,i,e){var n=void 0===e;switch(i.length){case 0:return n?t():t.call(e);case 1:return n?t(i[0]):t.call(e,i[0]);case 2:return n?t(i[0],i[1]):t.call(e,i[0],i[1]);case 3:return n?t(i[0],i[1],i[2]):t.call(e,i[0],i[1],i[2]);case 4:return n?t(i[0],i[1],i[2],i[3]):t.call(e,i[0],i[1],i[2],i[3])}return t.apply(e,i)}},function(t,i,e){var n=e(0).document;t.exports=n&&n.documentElement},function(t,i){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,i,e){"use strict";e.r(i);var n={};e.r(n),e.d(n,"degrees2radians",(function(){return l})),e.d(n,"max3",(function(){return _})),e.d(n,"min3",(function(){return c})),e.d(n,"intInRange",(function(){return d})),e.d(n,"inRange0to255Rounded",(function(){return p})),e.d(n,"inRange0to255",(function(){return f})),e.d(n,"stableSort",(function(){return M}));var s,r,a,u,o,h={};\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * constants.ts - part of Image Quantization Library\n */\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * rgb2xyz.ts - part of Image Quantization Library\n */\nfunction m(t){return t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92}function l(t){return t*(Math.PI/180)}function _(t,i,e){let n=t;return n<i&&(n=i),n<e&&(n=e),n}function c(t,i,e){let n=t;return n>i&&(n=i),n>e&&(n=e),n}function d(t,i,e){return t>e&&(t=e),t<i&&(t=i),0|t}function p(t){return(t=Math.round(t))>255?t=255:t<0&&(t=0),t}function f(t){return t>255?t=255:t<0&&(t=0),t}function M(t,i){const e=typeof t[0];let n;if("number"===e||"string"===e){const e=Object.create(null);for(let i=0,n=t.length;i<n;i++){const n=t[i];e[n]||0===e[n]||(e[n]=i)}n=t.sort((function(t,n){return i(t,n)||e[t]-e[n]}))}else{const e=t.slice(0);n=t.sort((function(t,n){return i(t,n)||e.indexOf(t)-e.indexOf(n)}))}return n}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * rgb2hsl.ts - part of Image Quantization Library\n */function g(t,i,e){const n=c(t,i,e),s=_(t,i,e),r=s-n,a=(n+s)/510;let u=0;a>0&&a<1&&(u=r/(a<.5?s+n:510-s-n));let o=0;return r>0&&(o=s===t?(i-e)/r:s===i?2+(e-t)/r:4+(t-i)/r,(o*=60)<0&&(o+=360)),{h:o,s:u,l:a}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * xyz2lab.ts - part of Image Quantization Library\n */e.r(h),e.d(h,"Point",(function(){return q})),e.d(h,"PointContainer",(function(){return F})),e.d(h,"Palette",(function(){return W})),e.d(h,"HueStatistics",(function(){return Q})),e.d(h,"ProgressTracker",(function(){return K})),e.d(h,"arithmetic",(function(){return n})),function(t){t[t.RED=.2126]="RED",t[t.GREEN=.7152]="GREEN",t[t.BLUE=.0722]="BLUE",t[t.WHITE=1]="WHITE"}(s||(s={})),(a=r||(r={}))[a.RED=.64]="RED",a[a.GREEN=.3]="GREEN",a[a.BLUE=.15]="BLUE",a[a.WHITE=.3127]="WHITE",(o=u||(u={}))[o.RED=.33]="RED",o[o.GREEN=.6]="GREEN",o[o.BLUE=.06]="BLUE",o[o.WHITE=.329]="WHITE";const b=.95047,x=1,w=1.08883;function y(t){return t>.008856?Math.pow(t,1/3):7.787*t+16/116}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * rgb2lab.ts - part of Image Quantization Library\n */\nfunction S(t,i,e){const n=function(t,i,e){return{x:.4124*(t=m(t/255))+.3576*(i=m(i/255))+.1805*(e=m(e/255)),y:.2126*t+.7152*i+.0722*e,z:.0193*t+.1192*i+.9505*e}}(t,i,e);return function(t,i,e){if(t=y(t/b),i=y(i/x),e=y(e/w),116*i-16<0)throw new Error("xxx");return{L:Math.max(0,116*i-16),a:500*(t-i),b:200*(i-e)}}(n.x,n.y,n.z)}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * lab2xyz.ts - part of Image Quantization Library\n */\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */\nclass k{constructor(){this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(t,i,e,n){this._whitePoint={r:t>0?255/t:0,g:i>0?255/i:0,b:e>0?255/e:0,a:n>0?255/n:0},this._maxDistance=this.calculateRaw(t,i,e,n,0,0,0,0)}calculateNormalized(t,i){return this.calculateRaw(t.r,t.g,t.b,t.a,i.r,i.g,i.b,i.a)/this._maxDistance}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * cie94.ts - part of Image Quantization Library\n */class z extends k{calculateRaw(t,i,e,n,s,r,a,u){const o=S(f(t*this._whitePoint.r),f(i*this._whitePoint.g),f(e*this._whitePoint.b)),h=S(f(s*this._whitePoint.r),f(r*this._whitePoint.g),f(a*this._whitePoint.b)),m=o.L-h.L,l=o.a-h.a,_=o.b-h.b,c=Math.sqrt(o.a*o.a+o.b*o.b),d=c-Math.sqrt(h.a*h.a+h.b*h.b);let p=l*l+_*_-d*d;p=p<0?0:Math.sqrt(p);const M=(u-n)*this._whitePoint.a*this._kA;return Math.sqrt(Math.pow(m/this._Kl,2)+Math.pow(d/(1+this._K1*c),2)+Math.pow(p/(1+this._K2*c),2)+Math.pow(M,2))}}class A extends z{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}}class B extends z{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * ciede2000.ts - part of Image Quantization Library\n */class P extends k{_setDefaults(){}static _calculatehp(t,i){const e=Math.atan2(t,i);return e>=0?e:e+P._deg360InRad}static _calculateRT(t,i){const e=Math.pow(i,7),n=2*Math.sqrt(e/(e+P._pow25to7)),s=P._deg30InRad*Math.exp(-Math.pow((t-P._deg275InRad)/P._deg25InRad,2));return-Math.sin(2*s)*n}static _calculateT(t){return 1-.17*Math.cos(t-P._deg30InRad)+.24*Math.cos(2*t)+.32*Math.cos(3*t+P._deg6InRad)-.2*Math.cos(4*t-P._deg63InRad)}static _calculate_ahp(t,i,e,n){const s=e+n;return 0===t?s:i<=P._deg180InRad?s/2:s<P._deg360InRad?(s+P._deg360InRad)/2:(s-P._deg360InRad)/2}static _calculate_dHp(t,i,e,n){let s;return s=0===t?0:i<=P._deg180InRad?e-n:e<=n?e-n+P._deg360InRad:e-n-P._deg360InRad,2*Math.sqrt(t)*Math.sin(s/2)}calculateRaw(t,i,e,n,s,r,a,u){const o=S(f(t*this._whitePoint.r),f(i*this._whitePoint.g),f(e*this._whitePoint.b)),h=S(f(s*this._whitePoint.r),f(r*this._whitePoint.g),f(a*this._whitePoint.b)),m=(u-n)*this._whitePoint.a*P._kA,l=this.calculateRawInLab(o,h);return Math.sqrt(l+m*m)}calculateRawInLab(t,i){const e=t.L,n=t.a,s=t.b,r=i.L,a=i.a,u=i.b,o=Math.sqrt(n*n+s*s),h=Math.sqrt(a*a+u*u),m=Math.pow((o+h)/2,7),l=.5*(1-Math.sqrt(m/(m+P._pow25to7))),_=(1+l)*n,c=(1+l)*a,d=Math.sqrt(_*_+s*s),p=Math.sqrt(c*c+u*u),f=d*p,M=P._calculatehp(s,_),g=P._calculatehp(u,c),b=Math.abs(M-g),x=r-e,w=p-d,y=P._calculate_dHp(f,b,g,M),S=P._calculate_ahp(f,b,M,g),k=P._calculateT(S),z=(d+p)/2,A=Math.pow((e+r)/2-50,2),B=1+.015*A/Math.sqrt(20+A),R=1+.045*z,E=1+.015*k*z,v=P._calculateRT(S,z),I=x/B,G=w/R,D=y/E;return Math.pow(I,2)+Math.pow(G,2)+Math.pow(D,2)+v*G*D}}P._kA=25/255,P._pow25to7=Math.pow(25,7),P._deg360InRad=l(360),P._deg180InRad=l(180),P._deg30InRad=l(30),P._deg6InRad=l(6),P._deg63InRad=l(63),P._deg275InRad=l(275),P._deg25InRad=l(25);\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * cmetric.ts - part of Image Quantization Library\n */\nclass R extends k{calculateRaw(t,i,e,n,s,r,a,u){const o=(t+s)/2*this._whitePoint.r,h=(t-s)*this._whitePoint.r,m=(i-r)*this._whitePoint.g,l=(e-a)*this._whitePoint.b,_=((512+o)*h*h>>8)+4*m*m+((767-o)*l*l>>8),c=(u-n)*this._whitePoint.a;return Math.sqrt(_+c*c)}_setDefaults(){}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * euclidean.ts - part of Image Quantization Library\n */class E extends k{calculateRaw(t,i,e,n,s,r,a,u){const o=s-t,h=r-i,m=a-e,l=u-n;return Math.sqrt(this._kR*o*o+this._kG*h*h+this._kB*m*m+this._kA*l*l)}}class v extends E{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}}class I extends E{_setDefaults(){this._kR=s.RED,this._kG=s.GREEN,this._kB=s.BLUE,this._kA=1}}class G extends E{_setDefaults(){this._kR=s.RED,this._kG=s.GREEN,this._kB=s.BLUE,this._kA=0}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * manhattanNeuQuant.ts - part of Image Quantization Library\n */class D extends k{calculateRaw(t,i,e,n,s,r,a,u){let o=s-t,h=r-i,m=a-e,l=u-n;return o<0&&(o=0-o),h<0&&(h=0-h),m<0&&(m=0-m),l<0&&(l=0-l),this._kR*o+this._kG*h+this._kB*m+this._kA*l}}class C extends D{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}}class N extends D{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}}class U extends D{_setDefaults(){this._kR=s.RED,this._kG=s.GREEN,this._kB=s.BLUE,this._kA=1}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * pngQuant.ts - part of Image Quantization Library\n */class T extends k{calculateRaw(t,i,e,n,s,r,a,u){const o=(u-n)*this._whitePoint.a;return this._colordifferenceCh(t*this._whitePoint.r,s*this._whitePoint.r,o)+this._colordifferenceCh(i*this._whitePoint.g,r*this._whitePoint.g,o)+this._colordifferenceCh(e*this._whitePoint.b,a*this._whitePoint.b,o)}_colordifferenceCh(t,i,e){const n=t-i,s=n+e;return n*n+s*s}_setDefaults(){}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */class L{quantizeSync(){for(const t of this.quantize())if(t.palette)return t.palette;throw new Error("unreachable")}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * point.ts - part of Image Quantization Library\n */class q{static createByQuadruplet(t){const i=new q;return i.r=0|t[0],i.g=0|t[1],i.b=0|t[2],i.a=0|t[3],i._loadUINT32(),i._loadQuadruplet(),i}static createByRGBA(t,i,e,n){const s=new q;return s.r=0|t,s.g=0|i,s.b=0|e,s.a=0|n,s._loadUINT32(),s._loadQuadruplet(),s}static createByUint32(t){const i=new q;return i.uint32=t>>>0,i._loadRGBA(),i._loadQuadruplet(),i}constructor(){this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}from(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.uint32=t.uint32,this.rgba[0]=t.r,this.rgba[1]=t.g,this.rgba[2]=t.b,this.rgba[3]=t.a}getLuminosity(t){let i=this.r,e=this.g,n=this.b;return t&&(i=Math.min(255,255-this.a+this.a*i/255),e=Math.min(255,255-this.a+this.a*e/255),n=Math.min(255,255-this.a+this.a*n/255)),i*s.RED+e*s.GREEN+n*s.BLUE}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * pointContainer.ts - part of Image Quantization Library\n */class F{constructor(){this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(t){this._width=t}setHeight(t){this._height=t}getPointArray(){return this._pointArray}clone(){const t=new F;t._width=this._width,t._height=this._height;for(let i=0,e=this._pointArray.length;i<e;i++)t._pointArray[i]=q.createByUint32(0|this._pointArray[i].uint32);return t}toUint32Array(){const t=this._pointArray.length,i=new Uint32Array(t);for(let e=0;e<t;e++)i[e]=this._pointArray[e].uint32;return i}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(t){const i=t.naturalWidth,e=t.naturalHeight,n=document.createElement("canvas");return n.width=i,n.height=e,n.getContext("2d").drawImage(t,0,0,i,e,0,0,i,e),F.fromHTMLCanvasElement(n)}static fromHTMLCanvasElement(t){const i=t.width,e=t.height,n=t.getContext("2d").getImageData(0,0,i,e);return F.fromImageData(n)}static fromImageData(t){const i=t.width,e=t.height;return F.fromUint8Array(t.data,i,e)}static fromUint8Array(t,i,e){switch(Object.prototype.toString.call(t)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:t=new Uint8Array(t)}const n=new Uint32Array(t.buffer);return F.fromUint32Array(n,i,e)}static fromUint32Array(t,i,e){const n=new F;n._width=i,n._height=e;for(let i=0,e=t.length;i<e;i++)n._pointArray[i]=q.createByUint32(0|t[i]);return n}static fromBuffer(t,i,e){const n=new Uint32Array(t.buffer,t.byteOffset,t.byteLength/Uint32Array.BYTES_PER_ELEMENT);return F.fromUint32Array(n,i,e)}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * palette.ts - part of Image Quantization Library\n */const O=10;function H(t,i){const e=360/i;for(let n=1,s=e-e/2;n<i;n++,s+=e)if(t>=s&&t<s+e)return n;return 0}class W{constructor(){this._pointArray=[],this._i32idx={},this._pointContainer=new F,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(t){this._pointArray.push(t),this._pointContainer.setWidth(this._pointArray.length)}has(t){for(let i=this._pointArray.length-1;i>=0;i--)if(t.uint32===this._pointArray[i].uint32)return!0;return!1}getNearestColor(t,i){return this._pointArray[0|this._getNearestIndex(t,i)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(t){return"number"==typeof this._i32idx[t]?this._i32idx[t]:-1}_getNearestIndex(t,i){let e=this._nearestPointFromCache(""+i.uint32);if(e>=0)return e;let n=Number.MAX_VALUE;e=0;for(let s=0,r=this._pointArray.length;s<r;s++){const r=this._pointArray[s],a=t.calculateRaw(i.r,i.g,i.b,i.a,r.r,r.g,r.b,r.a);a<n&&(n=a,e=s)}return this._i32idx[i.uint32]=e,e}sort(){this._i32idx={},this._pointArray.sort((t,i)=>{const e=g(t.r,t.g,t.b),n=g(i.r,i.g,i.b),s=t.r===t.g&&t.g===t.b?0:1+H(e.h,O),r=(i.r===i.g&&i.g===i.b?0:1+H(n.h,O))-s;if(r)return-r;const a=t.getLuminosity(!0),u=i.getLuminosity(!0);if(u-a!=0)return u-a;const o=(100*n.s|0)-(100*e.s|0);return o?-o:0})}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * hueStatistics.ts - part of Image Quantization Library\n */class j{constructor(){this.num=0,this.cols=[]}}class Q{constructor(t,i){this._numGroups=t,this._minCols=i,this._stats=[];for(let i=0;i<=t;i++)this._stats[i]=new j;this._groupsFull=0}check(t){this._groupsFull===this._numGroups+1&&(this.check=function(){});const i=255&t,e=t>>>8&255,n=t>>>16&255,s=i===e&&e===n?0:1+H(g(i,e,n).h,this._numGroups),r=this._stats[s],a=this._minCols;r.num++,r.num>a||(r.num===a&&this._groupsFull++,r.num<=a&&this._stats[s].cols.push(t))}injectIntoDictionary(t){for(let i=0;i<=this._numGroups;i++)this._stats[i].num<=this._minCols&&this._stats[i].cols.forEach(i=>{t[i]?t[i]++:t[i]=1})}injectIntoArray(t){for(let i=0;i<=this._numGroups;i++)this._stats[i].num<=this._minCols&&this._stats[i].cols.forEach(i=>{-1===t.indexOf(i)&&t.push(i)})}}class K{constructor(t,i){this._range=t,this._progressRange=i,this._step=Math.max(1,this._range/(K.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(t){return t-this._last>=this._step&&(this._last=t,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}}K.steps=100;\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */\n/**\n * @preserve TypeScript port:\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * neuquant.ts - part of Image Quantization Library\n */\nconst V=3;class J{constructor(t){this.r=this.g=this.b=this.a=t}toPoint(){return q.createByRGBA(this.r>>V,this.g>>V,this.b>>V,this.a>>V)}subtract(t,i,e,n){this.r-=0|t,this.g-=0|i,this.b-=0|e,this.a-=0|n}}class X extends L{constructor(t,i=256){super(),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=i,this._distance.setWhitePoint(255<<V,255<<V,255<<V,255<<V)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new J((t<<V+8)/this._networkSize|0),this._freq[t]=X._initialBias/this._networkSize|0,this._bias[t]=0}*_learn(){let t=this._sampleFactor;const i=this._pointArray.length;i<X._minpicturebytes&&(t=1);const e=30+(t-1)/3|0,n=i/t|0;let s,r=n/X._nCycles|0,a=X._initAlpha,u=(this._networkSize>>3)*X._radiusBias,o=u>>X._radiusBiasShift;o<=1&&(o=0);for(let t=0;t<o;t++)this._radPower[t]=a*((o*o-t*t)*X._radBias/(o*o))>>>0;s=i<X._minpicturebytes?1:i%X._prime1!=0?X._prime1:i%X._prime2!=0?X._prime2:i%X._prime3!=0?X._prime3:X._prime4;const h=new K(n,99);for(let t=0,m=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});const n=this._pointArray[m],l=n.b<<V,_=n.g<<V,c=n.r<<V,d=n.a<<V,p=this._contest(l,_,c,d);if(this._alterSingle(a,p,l,_,c,d),0!==o&&this._alterNeighbour(o,p,l,_,c,d),(m+=s)>=i&&(m-=i),0===r&&(r=1),++t%r==0){a-=a/e|0,(o=(u-=u/X._radiusDecrease|0)>>X._radiusBiasShift)<=1&&(o=0);for(let t=0;t<o;t++)this._radPower[t]=a*((o*o-t*t)*X._radBias/(o*o))>>>0}}}_buildPalette(){const t=new W;return this._network.forEach(i=>{t.add(i.toPoint())}),t.sort(),t}_alterNeighbour(t,i,e,n,s,r){let a=i-t;a<-1&&(a=-1);let u=i+t;u>this._networkSize&&(u=this._networkSize);let o=i+1,h=i-1,m=1;for(;o<u||h>a;){const t=this._radPower[m++]/X._alphaRadBias;if(o<u){const i=this._network[o++];i.subtract(t*(i.r-s),t*(i.g-n),t*(i.b-e),t*(i.a-r))}if(h>a){const i=this._network[h--];i.subtract(t*(i.r-s),t*(i.g-n),t*(i.b-e),t*(i.a-r))}}}_alterSingle(t,i,e,n,s,r){t/=X._initAlpha;const a=this._network[i];a.subtract(t*(a.r-s),t*(a.g-n),t*(a.b-e),t*(a.a-r))}_contest(t,i,e,n){const s=1020<<V;let r=~(1<<31),a=r,u=-1,o=u;for(let h=0;h<this._networkSize;h++){const m=this._network[h],l=this._distance.calculateNormalized(m,{r:e,g:i,b:t,a:n})*s|0;l<r&&(r=l,u=h);const _=l-(this._bias[h]>>X._initialBiasShift-V);_<a&&(a=_,o=h);const c=this._freq[h]>>X._betaShift;this._freq[h]-=c,this._bias[h]+=c<<X._gammaShift}return this._freq[u]+=X._beta,this._bias[u]-=X._betaGamma,o}}X._prime1=499,X._prime2=491,X._prime3=487,X._prime4=503,X._minpicturebytes=X._prime4,X._nCycles=100,X._initialBiasShift=16,X._initialBias=1<<X._initialBiasShift,X._gammaShift=10,X._betaShift=10,X._beta=X._initialBias>>X._betaShift,X._betaGamma=X._initialBias<<X._gammaShift-X._betaShift,X._radiusBiasShift=6,X._radiusBias=1<<X._radiusBiasShift,X._radiusDecrease=30,X._alphaBiasShift=10,X._initAlpha=1<<X._alphaBiasShift,X._radBiasShift=8,X._radBias=1<<X._radBiasShift,X._alphaRadBiasShift=X._alphaBiasShift+X._radBiasShift,X._alphaRadBias=1<<X._alphaRadBiasShift;\n/**\n * @preserve TypeScript port:\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * neuquant.ts - part of Image Quantization Library\n */\nconst $=3;class Y{constructor(t){this.r=this.g=this.b=this.a=t}toPoint(){return q.createByRGBA(this.r>>$,this.g>>$,this.b>>$,this.a>>$)}subtract(t,i,e,n){this.r-=t,this.g-=i,this.b-=e,this.a-=n}}class Z extends L{constructor(t,i=256){super(),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=i,this._distance.setWhitePoint(255<<$,255<<$,255<<$,255<<$)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new Y((t<<$+8)/this._networkSize),this._freq[t]=Z._initialBias/this._networkSize,this._bias[t]=0}*_learn(){let t=this._sampleFactor;const i=this._pointArray.length;i<Z._minpicturebytes&&(t=1);const e=30+(t-1)/3,n=i/t;let s,r=n/Z._nCycles|0,a=Z._initAlpha,u=(this._networkSize>>3)*Z._radiusBias,o=u>>Z._radiusBiasShift;o<=1&&(o=0);for(let t=0;t<o;t++)this._radPower[t]=a*((o*o-t*t)*Z._radBias/(o*o));s=i<Z._minpicturebytes?1:i%Z._prime1!=0?Z._prime1:i%Z._prime2!=0?Z._prime2:i%Z._prime3!=0?Z._prime3:Z._prime4;const h=new K(n,99);for(let t=0,m=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});const n=this._pointArray[m],l=n.b<<$,_=n.g<<$,c=n.r<<$,d=n.a<<$,p=this._contest(l,_,c,d);if(this._alterSingle(a,p,l,_,c,d),0!==o&&this._alterNeighbour(o,p,l,_,c,d),(m+=s)>=i&&(m-=i),0===r&&(r=1),++t%r==0){a-=a/e,(o=(u-=u/Z._radiusDecrease)>>Z._radiusBiasShift)<=1&&(o=0);for(let t=0;t<o;t++)this._radPower[t]=a*((o*o-t*t)*Z._radBias/(o*o))}}}_buildPalette(){const t=new W;return this._network.forEach(i=>{t.add(i.toPoint())}),t.sort(),t}_alterNeighbour(t,i,e,n,s,r){let a=i-t;a<-1&&(a=-1);let u=i+t;u>this._networkSize&&(u=this._networkSize);let o=i+1,h=i-1,m=1;for(;o<u||h>a;){const t=this._radPower[m++]/Z._alphaRadBias;if(o<u){const i=this._network[o++];i.subtract(t*(i.r-s),t*(i.g-n),t*(i.b-e),t*(i.a-r))}if(h>a){const i=this._network[h--];i.subtract(t*(i.r-s),t*(i.g-n),t*(i.b-e),t*(i.a-r))}}}_alterSingle(t,i,e,n,s,r){t/=Z._initAlpha;const a=this._network[i];a.subtract(t*(a.r-s),t*(a.g-n),t*(a.b-e),t*(a.a-r))}_contest(t,i,e,n){const s=1020<<$;let r=~(1<<31),a=r,u=-1,o=u;for(let h=0;h<this._networkSize;h++){const m=this._network[h],l=this._distance.calculateNormalized(m,{r:e,g:i,b:t,a:n})*s;l<r&&(r=l,u=h);const _=l-(this._bias[h]>>Z._initialBiasShift-$);_<a&&(a=_,o=h);const c=this._freq[h]>>Z._betaShift;this._freq[h]-=c,this._bias[h]+=c<<Z._gammaShift}return this._freq[u]+=Z._beta,this._bias[u]-=Z._betaGamma,o}}Z._prime1=499,Z._prime2=491,Z._prime3=487,Z._prime4=503,Z._minpicturebytes=Z._prime4,Z._nCycles=100,Z._initialBiasShift=16,Z._initialBias=1<<Z._initialBiasShift,Z._gammaShift=10,Z._betaShift=10,Z._beta=Z._initialBias>>Z._betaShift,Z._betaGamma=Z._initialBias<<Z._gammaShift-Z._betaShift,Z._radiusBiasShift=6,Z._radiusBias=1<<Z._radiusBiasShift,Z._radiusDecrease=30,Z._alphaBiasShift=10,Z._initAlpha=1<<Z._alphaBiasShift,Z._radBiasShift=8,Z._radBias=1<<Z._radBiasShift,Z._alphaRadBiasShift=Z._alphaBiasShift+Z._radBiasShift,Z._alphaRadBias=1<<Z._alphaRadBiasShift;\n/**\n * @preserve TypeScript port:\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * colorHistogram.ts - part of Image Quantization Library\n */\nclass tt{constructor(t,i){this._method=t,this._minHueCols=i<<2,this._initColors=i<<2,this._hueStats=new Q(tt._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(t){switch(this._method){case 1:this._colorStats1D(t);break;case 2:this._colorStats2D(t)}}getImportanceSortedColorsIDXI32(){const t=M(Object.keys(this._histogram),(t,i)=>this._histogram[i]-this._histogram[t]);if(0===t.length)return[];let i;switch(this._method){case 1:const e=Math.min(t.length,this._initColors),n=t[e-1],s=this._histogram[n];i=t.slice(0,e);let r=e;const a=t.length;for(;r<a&&this._histogram[t[r]]===s;)i.push(t[r++]);this._hueStats.injectIntoArray(i);break;case 2:i=t;break;default:throw new Error("Incorrect method")}return i.map((function(t){return+t}))}_colorStats1D(t){const i=this._histogram,e=t.getPointArray(),n=e.length;for(let t=0;t<n;t++){const n=e[t].uint32;this._hueStats.check(n),n in i?i[n]++:i[n]=1}}_colorStats2D(t){const i=t.getWidth(),e=t.getHeight(),n=t.getPointArray(),s=tt._boxSize[0],r=tt._boxSize[1],a=s*r,u=this._makeBoxes(i,e,s,r),o=this._histogram;u.forEach(t=>{let e=Math.round(t.w*t.h/a)*tt._boxPixels;e<2&&(e=2);const s={};this._iterateBox(t,i,t=>{const i=n[t].uint32;this._hueStats.check(i),i in o?o[i]++:i in s?++s[i]>=e&&(o[i]=s[i]):s[i]=1})}),this._hueStats.injectIntoDictionary(o)}_iterateBox(t,i,e){const n=t,s=n.y*i+n.x,r=(n.y+n.h-1)*i+(n.x+n.w-1),a=i-n.w+1;let u=0,o=s;do{e.call(this,o),o+=++u%n.w==0?a:1}while(o<=r)}_makeBoxes(t,i,e,n){const s=t%e,r=i%n,a=t-s,u=i-r,o=[];for(let h=0;h<i;h+=n)for(let i=0;i<t;i+=e)o.push({x:i,y:h,w:i===a?s:e,h:h===u?r:n});return o}}tt._boxSize=[64,64],tt._boxPixels=2,tt._hueGroups=10;\n/**\n * @preserve TypeScript port:\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * rgbquant.ts - part of Image Quantization Library\n */\nclass it{constructor(t,i,e){this.index=t,this.color=i,this.distance=e}}class et extends L{constructor(t,i=256,e=2){super(),this._distance=t,this._colors=i,this._histogram=new tt(e,i),this._initialDistance=.01,this._distanceIncrement=.005}sample(t){this._histogram.sample(t)}*quantize(){const t=this._histogram.getImportanceSortedColorsIDXI32();if(0===t.length)throw new Error("No colors in image");yield*this._buildPalette(t)}*_buildPalette(t){const i=new W,e=i.getPointContainer().getPointArray(),n=new Array(t.length);for(let i=0;i<t.length;i++)e.push(q.createByUint32(t[i])),n[i]=1;const s=e.length,r=[];let a=s,u=this._initialDistance;const o=new K(a-this._colors,99);for(;a>this._colors;){r.length=0;for(let t=0;t<s;t++){if(o.shouldNotify(s-a)&&(yield{progress:o.progress}),0===n[t])continue;const i=e[t];for(let o=t+1;o<s;o++){if(0===n[o])continue;const t=e[o],s=this._distance.calculateNormalized(i,t);s<u&&(r.push(new it(o,t,s)),n[o]=0,a--)}}u+=a>3*this._colors?this._initialDistance:this._distanceIncrement}if(a<this._colors){M(r,(function(t,i){return i.distance-t.distance}));let t=0;for(;a<this._colors&&t<r.length;){n[r[t].index]=1,a++,t++}}let h=e.length;for(let t=h-1;t>=0;t--)0===n[t]&&(t!==h-1&&(e[t]=e[h-1]),--h);e.length=h,i.sort(),yield{palette:i,progress:100}}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * wuQuant.ts - part of Image Quantization Library\n */function nt(t){const i=[];for(let e=0;e<t;e++)i[e]=0;return i}function st(t,i,e,n){const s=new Array(t);for(let r=0;r<t;r++){s[r]=new Array(i);for(let t=0;t<i;t++){s[r][t]=new Array(e);for(let i=0;i<e;i++){s[r][t][i]=new Array(n);for(let e=0;e<n;e++)s[r][t][i][e]=0}}}return s}function rt(t,i,e){const n=new Array(t);for(let s=0;s<t;s++){n[s]=new Array(i);for(let t=0;t<i;t++){n[s][t]=new Array(e);for(let i=0;i<e;i++)n[s][t][i]=0}}return n}function at(t,i,e,n,s){for(let r=0;r<i;r++){t[r]=[];for(let i=0;i<e;i++){t[r][i]=[];for(let e=0;e<n;e++)t[r][i][e]=s}}}function ut(t,i,e){for(let n=0;n<i;n++)t[n]=e}class ot{}class ht extends L{constructor(t,i=256,e=5){super(),this._distance=t,this._setQuality(e),this._initialize(i)}sample(t){const i=t.getPointArray();for(let t=0,e=i.length;t<e;t++)this._addColor(i[t]);this._pixels=this._pixels.concat(i)}*quantize(){yield*this._preparePalette();const t=new W;for(let i=0;i<this._colors;i++)if(this._sums[i]>0){const e=this._sums[i],n=this._reds[i]/e,s=this._greens[i]/e,r=this._blues[i]/e,a=this._alphas[i]/e,u=q.createByRGBA(0|n,0|s,0|r,0|a);t.add(u)}t.sort(),yield{palette:t,progress:100}}*_preparePalette(){yield*this._calculateMoments();let t=0;const i=nt(this._colors);for(let e=1;e<this._colors;++e){this._cut(this._cubes[t],this._cubes[e])?(i[t]=this._cubes[t].volume>1?this._calculateVariance(this._cubes[t]):0,i[e]=this._cubes[e].volume>1?this._calculateVariance(this._cubes[e]):0):(i[t]=0,e--),t=0;let n=i[0];for(let s=1;s<=e;++s)i[s]>n&&(n=i[s],t=s);if(n<=0){this._colors=e+1;break}}const e=[],n=[],s=[],r=[];for(let t=0;t<this._colors;++t){const i=ht._volume(this._cubes[t],this._weights);i>0?(e[t]=ht._volume(this._cubes[t],this._momentsRed)/i|0,n[t]=ht._volume(this._cubes[t],this._momentsGreen)/i|0,s[t]=ht._volume(this._cubes[t],this._momentsBlue)/i|0,r[t]=ht._volume(this._cubes[t],this._momentsAlpha)/i|0):(e[t]=0,n[t]=0,s[t]=0,r[t]=0)}this._reds=nt(this._colors+1),this._greens=nt(this._colors+1),this._blues=nt(this._colors+1),this._alphas=nt(this._colors+1),this._sums=nt(this._colors+1);for(let t=0,i=this._pixels.length;t<i;t++){const i=this._pixels[t];let a=-1,u=Number.MAX_VALUE;for(let t=0;t<this._colors;t++){const o=e[t],h=n[t],m=s[t],l=r[t],_=this._distance.calculateRaw(o,h,m,l,i.r,i.g,i.b,i.a);_<u&&(u=_,a=t)}this._reds[a]+=i.r,this._greens[a]+=i.g,this._blues[a]+=i.b,this._alphas[a]+=i.a,this._sums[a]++}}_addColor(t){const i=8-this._significantBitsPerChannel,e=1+(t.r>>i),n=1+(t.g>>i),s=1+(t.b>>i),r=1+(t.a>>i);this._weights[r][e][n][s]++,this._momentsRed[r][e][n][s]+=t.r,this._momentsGreen[r][e][n][s]+=t.g,this._momentsBlue[r][e][n][s]+=t.b,this._momentsAlpha[r][e][n][s]+=t.a,this._moments[r][e][n][s]+=this._table[t.r]+this._table[t.g]+this._table[t.b]+this._table[t.a]}*_calculateMoments(){const t=[],i=[],e=[],n=[],s=[],r=[],a=rt(this._sideSize,this._sideSize,this._sideSize),u=rt(this._sideSize,this._sideSize,this._sideSize),o=rt(this._sideSize,this._sideSize,this._sideSize),h=rt(this._sideSize,this._sideSize,this._sideSize),m=rt(this._sideSize,this._sideSize,this._sideSize),l=rt(this._sideSize,this._sideSize,this._sideSize);let _=0;const c=new K(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let d=1;d<=this._alphaMaxSideIndex;++d){at(a,this._sideSize,this._sideSize,this._sideSize,0),at(u,this._sideSize,this._sideSize,this._sideSize,0),at(o,this._sideSize,this._sideSize,this._sideSize,0),at(h,this._sideSize,this._sideSize,this._sideSize,0),at(m,this._sideSize,this._sideSize,this._sideSize,0),at(l,this._sideSize,this._sideSize,this._sideSize,0);for(let p=1;p<=this._maxSideIndex;++p,++_){c.shouldNotify(_)&&(yield{progress:c.progress}),ut(t,this._sideSize,0),ut(i,this._sideSize,0),ut(e,this._sideSize,0),ut(n,this._sideSize,0),ut(s,this._sideSize,0),ut(r,this._sideSize,0);for(let _=1;_<=this._maxSideIndex;++_){let c=0,f=0,M=0,g=0,b=0,x=0;for(let w=1;w<=this._maxSideIndex;++w)c+=this._weights[d][p][_][w],f+=this._momentsRed[d][p][_][w],M+=this._momentsGreen[d][p][_][w],g+=this._momentsBlue[d][p][_][w],b+=this._momentsAlpha[d][p][_][w],x+=this._moments[d][p][_][w],t[w]+=c,i[w]+=f,e[w]+=M,n[w]+=g,s[w]+=b,r[w]+=x,a[p][_][w]=a[p-1][_][w]+t[w],u[p][_][w]=u[p-1][_][w]+i[w],o[p][_][w]=o[p-1][_][w]+e[w],h[p][_][w]=h[p-1][_][w]+n[w],m[p][_][w]=m[p-1][_][w]+s[w],l[p][_][w]=l[p-1][_][w]+r[w],this._weights[d][p][_][w]=this._weights[d-1][p][_][w]+a[p][_][w],this._momentsRed[d][p][_][w]=this._momentsRed[d-1][p][_][w]+u[p][_][w],this._momentsGreen[d][p][_][w]=this._momentsGreen[d-1][p][_][w]+o[p][_][w],this._momentsBlue[d][p][_][w]=this._momentsBlue[d-1][p][_][w]+h[p][_][w],this._momentsAlpha[d][p][_][w]=this._momentsAlpha[d-1][p][_][w]+m[p][_][w],this._moments[d][p][_][w]=this._moments[d-1][p][_][w]+l[p][_][w]}}}}static _volumeFloat(t,i){return i[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMaximum]-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(i[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum])}static _volume(t,i){return 0|ht._volumeFloat(t,i)}static _top(t,i,e,n){let s;switch(i){case ht._alpha:s=n[e][t.redMaximum][t.greenMaximum][t.blueMaximum]-n[e][t.redMaximum][t.greenMinimum][t.blueMaximum]-n[e][t.redMinimum][t.greenMaximum][t.blueMaximum]+n[e][t.redMinimum][t.greenMinimum][t.blueMaximum]-(n[e][t.redMaximum][t.greenMaximum][t.blueMinimum]-n[e][t.redMaximum][t.greenMinimum][t.blueMinimum]-n[e][t.redMinimum][t.greenMaximum][t.blueMinimum]+n[e][t.redMinimum][t.greenMinimum][t.blueMinimum]);break;case ht._red:s=n[t.alphaMaximum][e][t.greenMaximum][t.blueMaximum]-n[t.alphaMaximum][e][t.greenMinimum][t.blueMaximum]-n[t.alphaMinimum][e][t.greenMaximum][t.blueMaximum]+n[t.alphaMinimum][e][t.greenMinimum][t.blueMaximum]-(n[t.alphaMaximum][e][t.greenMaximum][t.blueMinimum]-n[t.alphaMaximum][e][t.greenMinimum][t.blueMinimum]-n[t.alphaMinimum][e][t.greenMaximum][t.blueMinimum]+n[t.alphaMinimum][e][t.greenMinimum][t.blueMinimum]);break;case ht._green:s=n[t.alphaMaximum][t.redMaximum][e][t.blueMaximum]-n[t.alphaMaximum][t.redMinimum][e][t.blueMaximum]-n[t.alphaMinimum][t.redMaximum][e][t.blueMaximum]+n[t.alphaMinimum][t.redMinimum][e][t.blueMaximum]-(n[t.alphaMaximum][t.redMaximum][e][t.blueMinimum]-n[t.alphaMaximum][t.redMinimum][e][t.blueMinimum]-n[t.alphaMinimum][t.redMaximum][e][t.blueMinimum]+n[t.alphaMinimum][t.redMinimum][e][t.blueMinimum]);break;case ht._blue:s=n[t.alphaMaximum][t.redMaximum][t.greenMaximum][e]-n[t.alphaMaximum][t.redMaximum][t.greenMinimum][e]-n[t.alphaMaximum][t.redMinimum][t.greenMaximum][e]+n[t.alphaMaximum][t.redMinimum][t.greenMinimum][e]-(n[t.alphaMinimum][t.redMaximum][t.greenMaximum][e]-n[t.alphaMinimum][t.redMaximum][t.greenMinimum][e]-n[t.alphaMinimum][t.redMinimum][t.greenMaximum][e]+n[t.alphaMinimum][t.redMinimum][t.greenMinimum][e]);break;default:throw new Error("impossible")}return 0|s}static _bottom(t,i,e){switch(i){case ht._alpha:return-e[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+e[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+e[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-e[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+e[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+e[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case ht._red:return-e[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+e[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+e[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-e[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+e[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+e[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case ht._green:return-e[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]+e[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+e[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-e[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+e[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+e[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case ht._blue:return-e[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]+e[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+e[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]-e[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-(-e[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+e[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+e[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-e[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);default:return 0}}_calculateVariance(t){const i=ht._volume(t,this._momentsRed),e=ht._volume(t,this._momentsGreen),n=ht._volume(t,this._momentsBlue),s=ht._volume(t,this._momentsAlpha);return ht._volumeFloat(t,this._moments)-(i*i+e*e+n*n+s*s)/ht._volume(t,this._weights)}_maximize(t,i,e,n,s,r,a,u,o){const h=0|ht._bottom(t,i,this._momentsRed),m=0|ht._bottom(t,i,this._momentsGreen),l=0|ht._bottom(t,i,this._momentsBlue),_=0|ht._bottom(t,i,this._momentsAlpha),c=0|ht._bottom(t,i,this._weights);let d=0,p=-1;for(let f=e;f<n;++f){let e=h+ht._top(t,i,f,this._momentsRed),n=m+ht._top(t,i,f,this._momentsGreen),M=l+ht._top(t,i,f,this._momentsBlue),g=_+ht._top(t,i,f,this._momentsAlpha),b=c+ht._top(t,i,f,this._weights);if(0!==b){let t=e*e+n*n+M*M+g*g,i=t/b;e=s-e,n=r-n,M=a-M,g=u-g,0!==(b=o-b)&&(i+=(t=e*e+n*n+M*M+g*g)/b)>d&&(d=i,p=f)}}return{max:d,position:p}}_cut(t,i){let e;const n=ht._volume(t,this._momentsRed),s=ht._volume(t,this._momentsGreen),r=ht._volume(t,this._momentsBlue),a=ht._volume(t,this._momentsAlpha),u=ht._volume(t,this._weights),o=this._maximize(t,ht._red,t.redMinimum+1,t.redMaximum,n,s,r,a,u),h=this._maximize(t,ht._green,t.greenMinimum+1,t.greenMaximum,n,s,r,a,u),m=this._maximize(t,ht._blue,t.blueMinimum+1,t.blueMaximum,n,s,r,a,u),l=this._maximize(t,ht._alpha,t.alphaMinimum+1,t.alphaMaximum,n,s,r,a,u);if(l.max>=o.max&&l.max>=h.max&&l.max>=m.max){if(e=ht._alpha,l.position<0)return!1}else e=o.max>=l.max&&o.max>=h.max&&o.max>=m.max?ht._red:h.max>=l.max&&h.max>=o.max&&h.max>=m.max?ht._green:ht._blue;switch(i.redMaximum=t.redMaximum,i.greenMaximum=t.greenMaximum,i.blueMaximum=t.blueMaximum,i.alphaMaximum=t.alphaMaximum,e){case ht._red:i.redMinimum=t.redMaximum=o.position,i.greenMinimum=t.greenMinimum,i.blueMinimum=t.blueMinimum,i.alphaMinimum=t.alphaMinimum;break;case ht._green:i.greenMinimum=t.greenMaximum=h.position,i.redMinimum=t.redMinimum,i.blueMinimum=t.blueMinimum,i.alphaMinimum=t.alphaMinimum;break;case ht._blue:i.blueMinimum=t.blueMaximum=m.position,i.redMinimum=t.redMinimum,i.greenMinimum=t.greenMinimum,i.alphaMinimum=t.alphaMinimum;break;case ht._alpha:i.alphaMinimum=t.alphaMaximum=l.position,i.blueMinimum=t.blueMinimum,i.redMinimum=t.redMinimum,i.greenMinimum=t.greenMinimum}return t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),i.volume=(i.redMaximum-i.redMinimum)*(i.greenMaximum-i.greenMinimum)*(i.blueMaximum-i.blueMinimum)*(i.alphaMaximum-i.alphaMinimum),!0}_initialize(t){this._colors=t,this._cubes=[];for(let i=0;i<t;i++)this._cubes[i]=new ot;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=st(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let t=0;t<256;++t)this._table[t]=t*t;this._pixels=[]}_setQuality(t=5){this._significantBitsPerChannel=t,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}}ht._alpha=3,ht._red=2,ht._green=1,ht._blue=0;\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */\nclass mt{quantizeSync(t,i){for(const e of this.quantize(t,i))if(e.pointContainer)return e.pointContainer;throw new Error("unreachable")}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * nearestColor.ts - part of Image Quantization Library\n */class lt extends mt{constructor(t){super(),this._distance=t}*quantize(t,i){const e=t.getPointArray(),n=t.getWidth(),s=t.getHeight(),r=new K(s,99);for(let t=0;t<s;t++){r.shouldNotify(t)&&(yield{progress:r.progress});for(let s=0,r=t*n;s<n;s++,r++){const t=e[r];t.from(i.getNearestColor(this._distance,t))}}yield{pointContainer:t,progress:100}}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * ditherErrorDiffusionArray.ts - part of Image Quantization Library\n */var _t,ct;!function(t){t[t.FloydSteinberg=0]="FloydSteinberg",t[t.FalseFloydSteinberg=1]="FalseFloydSteinberg",t[t.Stucki=2]="Stucki",t[t.Atkinson=3]="Atkinson",t[t.Jarvis=4]="Jarvis",t[t.Burkes=5]="Burkes",t[t.Sierra=6]="Sierra",t[t.TwoSierra=7]="TwoSierra",t[t.SierraLite=8]="SierraLite"}(_t||(_t={}));class dt extends mt{constructor(t,i,e=!0,n=0,s=!1){super(),this._setKernel(i),this._distance=t,this._minColorDistance=n,this._serpentine=e,this._calculateErrorLikeGIMP=s}*quantize(t,i){const e=t.getPointArray(),n=new q,s=t.getWidth(),r=t.getHeight(),a=[];let u=1,o=1;for(const t of this._kernel){const i=t[2]+1;o<i&&(o=i)}for(let t=0;t<o;t++)this._fillErrorLine(a[t]=[],s);const h=new K(r,99);for(let t=0;t<r;t++){h.shouldNotify(t)&&(yield{progress:h.progress}),this._serpentine&&(u*=-1);const o=t*s,m=1===u?0:s-1,l=1===u?s:-1;this._fillErrorLine(a[0],s),a.push(a.shift());const _=a[0];for(let h=m,c=o+m;h!==l;h+=u,c+=u){const o=e[c],m=_[h];n.from(o);const l=q.createByRGBA(p(o.r+m[0]),p(o.g+m[1]),p(o.b+m[2]),p(o.a+m[3])),d=i.getNearestColor(this._distance,l);if(o.from(d),this._minColorDistance){if(this._distance.calculateNormalized(o,d)<this._minColorDistance)continue}let f,M,g,b;this._calculateErrorLikeGIMP?(f=l.r-d.r,M=l.g-d.g,g=l.b-d.b,b=l.a-d.a):(f=n.r-d.r,M=n.g-d.g,g=n.b-d.b,b=n.a-d.a);const x=1===u?0:this._kernel.length-1,w=1===u?this._kernel.length:-1;for(let i=x;i!==w;i+=u){const e=this._kernel[i][1]*u,n=this._kernel[i][2];if(e+h>=0&&e+h<s&&n+t>=0&&n+t<r){const t=this._kernel[i][0],s=a[n][e+h];s[0]=s[0]+f*t,s[1]=s[1]+M*t,s[2]=s[2]+g*t,s[3]=s[3]+b*t}}}}yield{pointContainer:t,progress:100}}_fillErrorLine(t,i){t.length>i&&(t.length=i);const e=t.length;for(let i=0;i<e;i++){const e=t[i];e[0]=e[1]=e[2]=e[3]=0}for(let n=e;n<i;n++)t[n]=[0,0,0,0]}_setKernel(t){switch(t){case _t.FloydSteinberg:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case _t.FalseFloydSteinberg:this._kernel=[[3/8,1,0],[3/8,0,1],[.25,1,1]];break;case _t.Stucki:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case _t.Atkinson:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case _t.Jarvis:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case _t.Burkes:this._kernel=[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]];break;case _t.Sierra:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case _t.TwoSierra:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]];break;case _t.SierraLite:this._kernel=[[.5,1,0],[.25,-1,1],[.25,0,1]];break;default:throw new Error("ErrorDiffusionArray: unknown kernel = "+t)}}}function*pt(t,i,e){const n=Math.max(t,i),s={width:t,height:i,level:Math.floor(Math.log(n)/Math.log(2)+1),callback:e,tracker:new K(t*i,99),index:0,x:0,y:0};yield*function*t(i,e){if(i.level<1)return;i.tracker.shouldNotify(i.index)&&(yield{progress:i.tracker.progress});switch(i.level--,e){case ct.LEFT:yield*t(i,ct.UP),ft(i,ct.RIGHT),yield*t(i,ct.LEFT),ft(i,ct.DOWN),yield*t(i,ct.LEFT),ft(i,ct.LEFT),yield*t(i,ct.DOWN);break;case ct.RIGHT:yield*t(i,ct.DOWN),ft(i,ct.LEFT),yield*t(i,ct.RIGHT),ft(i,ct.UP),yield*t(i,ct.RIGHT),ft(i,ct.RIGHT),yield*t(i,ct.UP);break;case ct.UP:yield*t(i,ct.LEFT),ft(i,ct.DOWN),yield*t(i,ct.UP),ft(i,ct.RIGHT),yield*t(i,ct.UP),ft(i,ct.UP),yield*t(i,ct.RIGHT);break;case ct.DOWN:yield*t(i,ct.RIGHT),ft(i,ct.UP),yield*t(i,ct.DOWN),ft(i,ct.LEFT),yield*t(i,ct.DOWN),ft(i,ct.DOWN),yield*t(i,ct.LEFT)}i.level++}(s,ct.UP),ft(s,ct.NONE)}function ft(t,i){switch(t.x>=0&&t.x<t.width&&t.y>=0&&t.y<t.height&&(t.callback(t.x,t.y),t.index++),i){case ct.LEFT:t.x--;break;case ct.RIGHT:t.x++;break;case ct.UP:t.y--;break;case ct.DOWN:t.y++}}\n/**\n * @preserve\n * MIT License\n *\n * Copyright 2015-2018 Igor Bezkrovnyi\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * riemersma.ts - part of Image Quantization Library\n */!function(t){t[t.NONE=0]="NONE",t[t.UP=1]="UP",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.DOWN=4]="DOWN"}(ct||(ct={}));class Mt extends mt{constructor(t,i=16,e=1){super(),this._distance=t,this._errorQueueSize=i,this._weights=Mt._createWeights(e,i)}*quantize(t,i){const e=t.getPointArray(),n=t.getWidth(),s=t.getHeight(),r=[];let a=0;for(let t=0;t<this._errorQueueSize;t++)r[t]={r:0,g:0,b:0,a:0};yield*pt(n,s,(t,s)=>{const u=e[t+s*n];let o=u.r,h=u.g,m=u.b,l=u.a;for(let t=0;t<this._errorQueueSize;t++){const i=this._weights[t],e=r[(t+a)%this._errorQueueSize];o+=e.r*i,h+=e.g*i,m+=e.b*i,l+=e.a*i}const _=q.createByRGBA(p(o),p(h),p(m),p(l)),c=i.getNearestColor(this._distance,_),d=((a=(a+1)%this._errorQueueSize)+this._errorQueueSize-1)%this._errorQueueSize;r[d].r=u.r-c.r,r[d].g=u.g-c.g,r[d].b=u.b-c.b,r[d].a=u.a-c.a,u.from(c)}),yield{pointContainer:t,progress:100}}static _createWeights(t,i){const e=[],n=Math.exp(Math.log(i)/(i-1));for(let s=0,r=1;s<i;s++)e[s]=(r+.5|0)/i*t,r*=n;return e}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */\ne(1);\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * helper.ts - part of Image Quantization Library\n */function gt(t="euclidean-bt709"){switch(t){case"cie94-graphic-arts":return new B;case"cie94-textiles":return new A;case"ciede2000":return new P;case"color-metric":return new R;case"euclidean":return new v;case"euclidean-bt709":return new I;case"euclidean-bt709-noalpha":return new G;case"manhattan":return new C;case"manhattan-bt709":return new U;case"manhattan-nommyde":return new N;case"pngquant":return new T;default:throw new Error(`Unknown colorDistanceFormula ${t}`)}}function bt(t,i="floyd-steinberg"){switch(i){case"nearest":return new lt(t);case"riemersma":return new Mt(t);case"floyd-steinberg":return new dt(t,_t.FloydSteinberg);case"false-floyd-steinberg":return new dt(t,_t.FalseFloydSteinberg);case"stucki":return new dt(t,_t.Stucki);case"atkinson":return new dt(t,_t.Atkinson);case"jarvis":return new dt(t,_t.Jarvis);case"burkes":return new dt(t,_t.Burkes);case"sierra":return new dt(t,_t.Sierra);case"two-sierra":return new dt(t,_t.TwoSierra);case"sierra-lite":return new dt(t,_t.SierraLite);default:throw new Error(`Unknown imageQuantization ${i}`)}}function xt(t,i="wuquant",e=256){switch(i){case"neuquant":return new X(t,e);case"rgbquant":return new et(t,e);case"wuquant":return new ht(t,e);case"neuquant-float":return new Z(t,e);default:throw new Error(`Unknown paletteQuantization ${i}`)}}\n/**\n * @preserve\n * Copyright 2015-2018 Igor Bezkrovnyi\n * All rights reserved. (MIT Licensed)\n *\n * iq.ts - Image Quantization Library\n */function wt(t){return t.map(t=>t.r<<16|t.g<<8|t.b)}function yt(t,i,e,n,s){const r=function(t,i,e){let n=0;const s=i*e*4,r=new Set;for(;n<s;){const i=t[n++],e=t[n++],s=t[n++];n++;const a=i<<16|e<<8|s;r.add(a)}let a=0;for(;a<16777215&&r.has(a);)a++;return a}(t,i,e),{rgba:a,hasTransparency:u}=function(t,i,e,n,s=.7){let r=0;const a=i*e*4,u=[],o=Math.trunc(255*s);let h=!1;const m=(16711680&n)>>16,l=(65280&n)>>8,_=255&n;for(;r<a;){const i=t[r++],e=t[r++],s=t[r++];let a=t[r++];a=a>=o?255:0,void 0!==n&&0===a?(u.push(m),u.push(l),u.push(_),u.push(0),h=!0):(u.push(i),u.push(e),u.push(s),u.push(255))}return{rgba:u,hasTransparency:h}}(t,i,e,r,n),o=h.PointContainer.fromUint8Array(new Uint8Array(a),i,e),m=function(t,{colorDistanceFormula:i,paletteQuantization:e,colors:n}={}){const s=xt(gt(i),e,n);return t.forEach(t=>s.sample(t)),s.quantizeSync()}([o],{paletteQuantization:"rgbquant",colors:u&&r?255:256});u&&r&&m.add(h.Point.createByUint32(r));const l=function(t,i,{colorDistanceFormula:e,imageQuantization:n}={}){return bt(gt(e),n).quantizeSync(t,i)}(o,m,{imageQuantization:s}),_=wt(m.getPointContainer().getPointArray());_.sort((t,i)=>t-i);const c=_.indexOf(r);return{pixels:function(t,i){return Uint8Array.from(t.map(t=>i.indexOf(t)))}(wt(l.getPointArray()),_),palette:Array.from(_),transparencyIndex:c>-1?c:void 0}}self.onmessage=function(t){var i=function(t){const{width:i,height:e,data:n,dithering:s,transparencyCutOff:r}=t;return yt(n,i,e,r,s)}(t.data);postMessage(i)}}]);',null)}},function(t,e,i){"use strict";i.r(e);var n=i(0),r=i(1),s=i.n(r);const a=function(t){let e=(t=t||{}).width||160,i=t.height||120;const r=t.dithering||void 0,a=t.palette||null,o=t.disposal||0,u=t.transparencyCutOff||.7;let h=null,l=null,m=0,c=250;const _=[];let d,p=0,f=function(){},g=function(){},M=[],b=[],w=!1;if(a){if(!(a instanceof Array))throw a;if(a.length<2||a.length>256){for(console.error("Palette must hold only between 2 and 256 colours");a.length<2;)a.push(0);a.length>256&&(a=a.slice(0,256))}if(!k(a.length))for(console.error("Palette must have a power of two number of colours");!k(a.length);)a.splice(a.length-1,1)}d=(t=t||{}).numWorkers||2;for(let t=0;t<d;t++){const t=new s.a;M.push(t),b.push(t)}const y=function(){let t=[];for(let e=0;e<256;e++)t[e]=String.fromCharCode(e);return function(e){const i=e.length;let n="";for(let r=0;r<i;r++)n+=t[e[r]];return n}}();function x(t){f=t;for(let t=0;t<d&&t<_.length;t++)S(t)}function S(t){let e,i;if((e=_[t]).beingProcessed||e.done)return console.error("Frame already being processed or done!",e.position),void I();e.beingProcessed=!0,(i=function(){if(0===b.length)throw"No workers left!";return b.pop()}()).onmessage=function(t){const n=t.data;delete e.data,e.pixels=Array.prototype.slice.call(n.pixels),e.palette=Array.prototype.slice.call(n.palette),e.transparencyIndex=n.transparencyIndex,e.done=!0,e.beingProcessed=!1,function(t){b.push(t)}(i),I()},i.postMessage(e)}function v(){let t=-1;for(let i=0;i<_.length;i++){var e=_[i];if(!e.done&&!e.beingProcessed){t=i;break}}t>=0&&S(t)}function I(){const t=_.every((function(t){return!t.beingProcessed&&t.done}));p++,g(.75*p/_.length),t?w||function(t,s){const o=[],u={loop:m};null!==r&&null!==a&&(u.palette=a);const h=new n.GifWriter(o,e,i,u);w=!0,t.forEach((function(n){let r=a||n.palette;for(g(.75+.25*n.position*1/t.length);!k(r.length)&&r.length<256;)r.push(0);h.addFrame(0,0,e,i,n.pixels,{palette:r,delay:c,transparent:n.transparencyIndex,disposal:n.disposal})})),h.end(),g(1),t=[],w=!1,s(o)}(_,f):setTimeout(v,1)}function k(t){return 0!==t&&0==(t&t-1)}this.setSize=function(t,n){e=t,i=n,(h=document.createElement("canvas")).width=t,h.height=n,l=h.getContext("2d")},this.setDelay=function(t){c=.1*t},this.setRepeat=function(t){m=t},this.addFrame=function(t,n={}){null===l&&this.setSize(e,i),l.clearRect(0,0,e,i),l.drawImage(t,0,0,e,i);const r=l.getImageData(0,0,e,i);this.addFrameImageData(r,n)},this.addFrameImageData=function(t,e={}){const i=new Uint8Array(t.data);_.push({data:i,width:t.width,height:t.height,palette:e.palette||a,dithering:e.dithering||r,disposal:e.disposal||o,transparencyCutOff:e.transparencyCutOff||u,done:!1,beingProcessed:!1,position:_.length})},this.onRenderProgress=function(t){g=t},this.isRendering=function(){return w},this.getBase64GIF=function(t){x((function(e){const i=y(e),n="data:image/gif;base64,"+btoa(i);t(n)}))},this.getBlobGIF=function(t){x((function(e){const i=new Uint8Array(e),n=new Blob([i],{type:"image/gif"});t(n)}))},this.destroy=function(){M.forEach((function(t){t.terminate()}))}};window.Animated_GIF=a,e.default=a},function(t,e,i){"use strict";var n=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var i;try{(i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),i=i.getBlob()}catch(e){i=new Blob([t])}return new Worker(n.createObjectURL(i))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}}]);